# Cursor Rules - Mailserver Project

## Tarefas Realizadas
- Configuração inicial do projeto
- Configuração do docker-compose.yml
- Configuração do ambiente com variáveis (.env)
- Configuração do GitHub Actions para deploy
- Configuração do Postfix e Dovecot
- Organização e limpeza dos scripts de configuração
- Melhorias na configuração SSL
- Adicionado suporte a verificação DNS completa
- Atualização do script setup.sh para configuração local
- Implementação de geração automática de certificados SSL
- Ajuste do docker-compose.yml para EasyPanel
- Otimização do Dockerfile para deploy
- Configuração de volumes persistentes para dados do mailserver
- Correção das permissões de diretórios
- Configuração do volume maildata para persistência

## Scripts do Projeto
1. setup.sh: Script principal de configuração
   - Configuração inicial do ambiente local
   - Geração de certificados SSL iniciais
   - Criação da estrutura de diretórios
   - Preparação para deploy

2. ssl-setup.sh: Gerenciamento de SSL
   - Geração de certificados auto-assinados
   - Configuração de CA
   - Gerenciamento de permissões

3. verificacao-dns.sh: Verificação DNS
   - Validação de registros A, MX
   - Verificação de SPF, DMARC, DKIM
   - Sugestões de configuração

4. check-config.sh: Validação de Configuração
   - Verificação do docker-compose
   - Validação do Postfix
   - Validação do Dovecot

5. entrypoint.sh: Script de Inicialização
   - Debug de hostname/domainname
   - Inicialização do mailserver
   - Geração de certificados de emergência

## Problemas Encontrados e Resolvidos
- Erro no deploy inicial usando Nixpacks (resolvido)
- Erro fatal de hostname/domainname não configurado (resolvido)
- Problemas com certificados SSL (resolvido)
- Duplicidade de scripts de configuração (resolvido)
- Configuração de hostname/domainname inconsistente (resolvido)
- Path de certificados SSL incorreto (resolvido)
- Necessidade de automatização da configuração local (resolvido)
- Erro no EasyPanel com nome da imagem incorreto (resolvido)
- Ajuste necessário no docker-compose.yml para EasyPanel (resolvido)
- Perda de dados após rebuild (resolvido com volumes persistentes)
- Problemas de permissão em diretórios (resolvido)

## Progresso Atual
- Scripts organizados e otimizados
- Estrutura de diretórios e arquivos limpa
- Configuração SSL melhorada
- Sistema de verificação DNS robusto
- Setup local automatizado
- Processo de deploy documentado
- Docker-compose.yml ajustado para EasyPanel
- Dockerfile otimizado para deploy
- Volumes persistentes configurados
- Permissões de diretórios corrigidas

## Próximos Passos
1. Fazer commit das alterações
2. Push para o repositório para deploy automático
3. Verificar status do deploy no EasyPanel
4. Validar configurações com check-config.sh
5. Configurar o domínio no provedor DNS
6. Executar verificacao-dns.sh para validar configuração
7. Testar fluxo de emails com ferramentas como swaks

## Detalhes Relevantes
- Todos os scripts foram revisados e otimizados
- Removidos scripts redundantes
- Padronização de nomes sem acentos
- Melhor organização da documentação
- Processo de deploy automatizado via EasyPanel
- Certificados SSL gerados localmente e no container
- Nome do serviço alterado para 'app' no EasyPanel
- Volumes e networks configurados corretamente
- Dados persistentes configurados com volume maildata
- Permissões de diretórios ajustadas para vmail:vmail 